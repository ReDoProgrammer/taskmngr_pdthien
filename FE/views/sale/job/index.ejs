<div class="row">
  <div class="offset-md-9 col-md-3 text-right">
    <!-- Another variation with a button -->
    <div class="input-group">
      <input type="text" class="form-control" placeholder="search job .." id="txtSearch"/>
      <div class="input-group-append">
        <button class="btn btn-warning" type="button" id="btnSearch">
          <i class="fa fa-search text-info"></i>
        </button>
      </div>
    </div>
  </div>
</div>
<div class="tableFixHead">
  <table class="table mt-1 table-striped bg-white text-dark">
    <thead class="thead-dark">
      <tr>
        <th scope="col">#</th>
        <th scope="col">Customer</th>
        <th scope="col">Job name</th>
        <th scope="col">Receive date</th>
        <th scope="col">Delivery date</th>
        <th scope="col">Intruction</th>
        <th scope="col">Status</th>
      </tr>
    </thead>
    <tbody id="tblData">
    </tbody>
  </table>
</div>

<nav aria-label="..." class="mt-3">
  <ul class="pagination pagination-sm">
    <li class="page-item disabled">
      <a class="page-link" href="#" tabindex="-1">1</a>
    </li>
    <li class="page-item"><a class="page-link" href="#">2</a></li>
    <li class="page-item"><a class="page-link" href="#">3</a></li>
  </ul>
</nav>


<script type='text/javascript'
  src="https://rawgit.com/RobinHerbots/jquery.inputmask/3.x/dist/jquery.inputmask.bundle.js"></script>


  
<script>
  var search = "";
  var page = 1;

  $(document).ready(function () {
    LoadJobs();
  });


  $('#btnSearch').click(function(){
    search = $('#txtSearch').val();
    LoadJobs();
  })


  $('#txtSearch').keyup(function(e){
    if(e.keyCode == 13)
    {
      $("#btnSearch").click()
    }
});


  function LoadJobs() {
    $.ajax({
      url: "/sale/job/list",
      type: "get",
      headers: {
        authorization: "Bearer " + localStorage.getItem("accessToken"),
      },
      data: {
        search,
        page,
      },
      success: function (data) {
        $("#tblData").empty();
        // $("#pagination").empty();
        let idx = 1;
        data.jobs.forEach((job) => {
          let tr = "  <tr id='" + job._id + "'>";
          tr += '<th scope="row">' + idx++ + "</th>";
          tr +=
            " <td class='font-weight-bold'>" + job.customer.firstname + " " + job.customer.lastname + "</td>";
          tr += "<td class='text-info font-weight-bold'>" + job.name + "</td>";
          tr += "<td>" + new Date(job.received_date).toLocaleString() + "</td>";
          tr += "<td>" + new Date(job.delivery_date).toLocaleString() + "</td>";
          tr += "<td>" + job.intruction + "</td>";

          tr += "<td class='text-right'>";
          tr +=
            '<button class="btn btn-sm btn-info" name="add_job"><i class="fa fa-eye mr-1" aria-hidden="true"></i></button>';
          tr += "</td>";
          $("#tblData").append(tr);
        });

        for (let i = 1; i <= data.pages; i++) {
          let li =
            '<li class="page-item"><a class="page-link" href="#">' +
            i +
            "</a></li>";
          $("#pagination").append(li);
        }
      },
      error: function (jqXHR, textStatus, errorThrown) {
        alert(jqXHR.responseJSON.msg + ". " + jqXHR.responseJSON.error);
      },
    });
  }

  $(document).on("click", "button[name='add_job']", function () {
    customerId = $(this).closest("tr").attr("id");
    $.ajax({
      url: "/sale/customer/detail",
      type: "get",
      headers: {
        authorization: "Bearer " + localStorage.getItem("accessToken"),
      },
      data: {
        customerId,
      },
      success: function (data, textStatus, xhr) {
        $("#customer_fullname").text(
          data.customer.firstname + " " + data.customer.lastname
        );
        $("#customer_phone").text(data.customer.phone);
        $("#customer_email").text(data.customer.email);
        $("#customer_address").text(data.customer.address);
        $("#customer_cloud").text(data.customer.cloud.name);

        $("#receive_date").datetimepicker({
          format: "DD/MM/YYYY HH:mm",
          pickDate: false,
          pickSeconds: false,
          pick12HourFormat: false,
        });

        $("#deadline").datetimepicker({
          format: "DD/MM/YYYY HH:mm",
          pickDate: false,
          pickSeconds: false,
          pick12HourFormat: false,
        });
        $("#receive_date").val("");
        $("#txtDeadline").val("");
        $("#txtSourceLink").val("");
        $("#txaIntruction").val("");
        $("#modalJob").modal();
      },
      error: function (jqXHR, textStatus, errorThrown) {
        alert(jqXHR.responseJSON.msg + ". " + jqXHR.responseJSON.error);
      },
    });
  });
</script>

<style>
  .tableFixHead {
    overflow: auto;
    height: 500px;
  }

  .tableFixHead thead th {
    position: sticky;
    top: 0;
    z-index: 1;
  }

  /* Just common table stuff. Really. */
  table {
    border-collapse: collapse;
    width: 100%;
  }

  th,
  td {
    padding: 8px 16px;
  }

  th {
    background: #eee;
  }
</style>