<div class="modal fade" id="modalWage" tabindex="-1" aria-labelledby="modalWage" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">
                <div class="panel panel-primary">
                    <div class="panel-heading"> Add or update wage</div>
                    <div class="panel-body">

                        <div class="form-row">
                            <div class="form-group col-md-4 col-xs-4">
                                <label for="recipient-name" class="col-form-label">Skill:</label>
                                <select name="" id="slSkills" class="form-control"></select>
                            </div>
                            <div class="form-group col-md-4 col-xs-4">
                                <label for="recipient-name" class="col-form-label">Staff level:</label>
                                <select name="" id="sllStaffLevels" class="form-control"></select>
                            </div>
                            <div class="form-group col-md-3 col-xs-2">
                                <label for="recipient-name" class="col-form-label">Wage:</label>
                                <input type="text" class="form-control text-right" id="txtWage" value="0" />
                            </div>

                            <div class="form-group col-md-1 col-xs-2">
                                <label for="recipient-name" class="col-form-label"></label>
                                <button class="btn btn-sm btn-warning mt-1" id="btnAddWage">
                                    <i class="fa fa-plus" aria-hidden="true"></i>
                                    Add
                                </button>
                            </div>

                        </div>

                        <table class="table table-striped mt-2">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Level</th>
                                    <th scope="col">Skill</th>
                                    <th scope="col">Wage</th>
                                    <th scope="col"></th>
                                </tr>
                            </thead>
                            <tbody id="tblWages"></tbody>
                        </table>

                        <div class="form-row">
                            <div class="col-md-12 col-xs-12 text-danger font-weight-bold" id="lblError"></div>
                        </div>


                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            $(document).ready(function () {
                LoadSkills();
                LoadStaffLevels();
                $('#lblError').hide();
            })

            $('#btnAddWage').click(function () {
                let skill = $('#slSkills option:selected').val();
                let level = $('#sllStaffLevels option:selected').val();
                let wage = parseFloat($('#txtWage').val());             
                $.ajax({
                    url: '/admin/user-group-wage',
                    type: 'post',
                    headers: {
                        authorization: "Bearer " + localStorage.getItem('accessToken'),
                    },
                    data: {
                        user_group: ugId,
                        skill,
                        level,
                        wage
                    },
                    success: function (data) {
                        LoadWages();
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('#lblError').text(jqXHR.responseJSON.msg);
                        $('#lblError').show();
                    },

                })

            })

            function LoadWages(){
                console.log('successfully!');
            }

            $("#txtWage").on("keypress keyup blur", function (event) {
                //this.value = this.value.replace(/[^0-9\.]/g,'');
                $(this).val($(this).val().replace(/[^0-9\.]/g, ''));
                if ((event.which != 46 || $(this).val().indexOf('.') != -1) && (event.which < 48 || event.which > 57)) {
                    event.preventDefault();
                }
            });


            function LoadStaffLevels() {
                $.ajax({
                    url: '/admin/staff-level',
                    type: 'get',
                    headers: {
                        authorization: "Bearer " + localStorage.getItem('accessToken'),
                    },
                    success: function (data) {
                        $('#sllStaffLevels').empty();
                        data.levels.forEach(l => {
                            let opt = '<option value="' + l._id + '">' + l.name + '</option>';
                            $('#sllStaffLevels').append(opt);
                        })
                    }
                })
            }

            function LoadSkills() {

                $.ajax({
                    url: '/admin/skill',
                    type: 'get',
                    headers: {
                        authorization: "Bearer " + localStorage.getItem('accessToken'),
                    },
                    success: function (data) {
                        $('#slSkills').empty();
                        data.skills.forEach(s => {
                            let opt = '<option value="' + s._id + '">' + s.name + '</option>';
                            $('#slSkills').append(opt);
                        })
                    }
                })
            }
        </script>