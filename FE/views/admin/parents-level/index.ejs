<button type="button" class="btn btn-primary" id="btnAddNew">
  <span>
    <i class="fa fa-plus" aria-hidden="true"></i>
  </span>
  Add New
</button>
<table class="table table-striped mt-2">
  <thead class="thead-dark">
    <tr>
      <th scope="col">#</th>
      <th scope="col">Name</th>
      <th scope="col">Description</th>
      <th scope="col">Children</th>
      <th scope="col"></th>
    </tr>
  </thead>
  <tbody id="tblParents"></tbody>
</table>




<script>

  var pId = '';
  $(document).ready(function () {
    LoadData();
  });

  function LoadData() {
    $('#tblParents').empty();
    $.ajax({
      url: '/admin/parents-level/list',
      type: 'get',
      headers: {
        authorization: "Bearer " + localStorage.getItem('accessToken'),
      },
      success: function (data) {
        let idx = 1;
        data.parentsList.forEach(pl => {
          let tr = '<tr id=' + pl._id + ' data-name = ' + pl.name + '>';
          tr += '<th scope="row">' + (idx++) + '</th>';
          tr += '<td class="font-weight-bold text-info">' + pl.name + '</td>';
          tr += '<td>' + pl.description + '</td>';
          console.log(pl.job_levles)
          tr += '<td class="text-right"><button class="btn btn-xs btn-info" name="list"><i class="fa fa-list" aria-hidden="true"></i></button>';
          tr += '<button class="btn btn-xs btn-warning ml-2" name="update"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></button>';
          tr += '<button class="btn btn-xs btn-danger ml-1" name="delete"><i class="fa fa-trash" aria-hidden="true"></i></button></td>';
          tr += '</tr>';
          $('#tblParents').append(tr);
        });
      },
      error: function (jqXHR, textStatus, errorThrown) {
        alert(jqXHR.responseJSON.msg);
      }
    })
  }


  $('#btnAddNew').click(function () {
    pId = '';
    $('#txtName').val('');
    $('#txaDescription').val('');
    $('#modalParentsLevel').modal();
  });


  //sự kiện load lại hàm ds level khi modal đc đóng lại
  $(document).on('hidden.bs.modal', '#modalParentsLevel', function () {
    LoadData();
  });


  $(document).on("click", "button[name='delete']", function () {
    pId = $(this).closest("tr").attr("id");
    Swal.fire({
      icon: 'question',
      title: 'Do you want to delete this parents level?',
      showDenyButton: true,
      showCancelButton: true,
      confirmButtonText: 'Yes',
      denyButtonText: `No`,
    }).then((result) => {
      if (result.isConfirmed) {
        $.ajax({
          url: '/admin/parents-level',
          type: 'delete',
          headers: {
            authorization: "Bearer " + localStorage.getItem('accessToken'),
          },
          data: {
            pId
          },
          success: function (data) {
            Swal.fire({
              icon: 'success',
              title: 'Congratulation',
              text: data.msg
            });
            LoadData();
          }
          , error: function (jqXHR, textStatus, errorThrown) {
            Swal.fire({
              icon: 'error',
              title: 'Opp..',
              text: jqXHR.responseJSON.msg
            });
          }
        })
      }
    })

  });

  $(document).on("click", "button[name='list']", function () {
    pId = $(this).closest("tr").attr("id");
    $('#modalList').modal();
  });


  $(document).on("click", "button[name='update']", function () {
    pId = $(this).closest("tr").attr("id");
    $.ajax({
      url: '/admin/parents-level/detail',
      type: 'get',
      headers: {
        authorization: "Bearer " + localStorage.getItem('accessToken'),
      },
      data: { pId },
      success: function (data) {
        $('#txtName').val(data.parents.name);
        $('#txaDescription').val(data.parents.description);
        $('#modalParentsLevel').modal();
      },
      error: function (jqXHR, textStatus, errorThrown) {
        Swal.fire({
          icon: 'error',
          title: 'Opp..',
          text: jqXHR.responseJSON.msg
        });
      }

    })

  });
</script>

<%-include('modal')%>
  <%-include('list')%>