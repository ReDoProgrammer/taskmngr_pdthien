<div class="row">
  <div class="col-md-offset-6 col-md-5 col-sm-offset-4 col-sm-6 col-xs-9 mt-2">
      <!-- Another variation with a button -->
      <div class="input-group">
          <input type="text" class="form-control" placeholder="Seach your job..." id="txtSearch" />
          <div class="input-group-btn">
              <button class="btn btn-info" type="submit" id="btnSearch">
                  <i class="fa fa-search" aria-hidden="true"></i>
              </button>
          </div>
      </div>
  </div>

  <div class="col-md-1 col-sm-2 col-xs-3 mt-2 text-right">
    <button class="btn btn-success" id="btnGetJob">
      <i class="fa fa-plus"></i> Get job
    </button>
  </div>
</div>


<div class="table-responsive mt-2">
  <table class="table table-striped">
    <thead class="thead-dark">
      <tr>
        <th scope="col">#</th>       
        <th scope="col">Level</th>
        <th scope="col">Deadline</th>
        <th>Local</th>
        <th>Cloud</th>
        <th scope="col">Intruction</th>
        <th scope="col">Remark</th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody id="tbdTasks">
    </tbody>
  </table>
</div>

<%-include('task_detail')%>

<script src="/js/common.js"></script>
  <script>
    var page  =1;
    var search = '';

    $(document).ready(function () {
      LoadTask();
    })

    var taskId = '';

    $(document).on("click", "button[name='btnTaskInfo']", function () {
      taskId = $(this).closest("tr").attr("id");
      $('#modalTaskDetail').modal();
    })


    function LoadTask() {
      $.ajax({
        url: '/task',
        type: 'get',
        headers: {
          authorization: "Bearer " + localStorage.getItem("accessToken"),
        },
        data: {
          page,
          search
        },
        success: function (data) {
          $('#tbdTasks').empty();
          console.log(data.tasks);
          let idx = 1;
          data.tasks.forEach(t => {
            let tr = '<tr id="' + t._id + '">';

            tr += '<td>' + (idx++) + '</td>';           
            tr += '<td class="font-weight-bold">' + t.level.name + '</td>';
            tr += '<td class="text-danger">' + convertISODateToTimeFormat(t.deadline) + '</td>';



            tr += '<td>' + t.job.intruction + '</td>';
            tr += '<td>' + t.remark + '</td>';

            tr += '<td class="text-right">';
            if (t.status == -1) {
              tr += '<button class="btn btn-sm btn-info" name="btnTaskInfo"><i class="fa fa-info-circle" aria-hidden="true"></i></button>';
            }
            tr += '<button class="ml-1 btn btn-sm btn-success" name="btnGetTask"><i class="fa fa-check" aria-hidden="true"></i></button></td>';

            tr += '</tr>';
            $('#tbdTasks').append(tr);
          })

        }, error: function (request, status, error) {
          alert(request.responseJSON.msg)
          window.location.href = '/editor/default';
        }

      })
    }

    function ConvertTimeStamp(timestamp) {

      let date = new Date(timestamp);
      console.log(date);
      let dd = date.getDate() < 10 ? '0' + date.getDate() : date.getDate();
      let month = (date.getMonth() + 1) < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1;
      let year = date.getFullYear();
      let hh = date.getHours() < 10 ? '0' + date.getHours() : date.getHours();
      let mm = date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes();

      return dd + '/' + month + '/' + year + ' ' + hh + ':' + mm;
    }
  </script>